<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDV Açaiteria</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-color: #8B008B;
            --secondary-color: #4B0082;
            --accent-color: #DA70D6;
            --light-color: #F5F0FF;
            --dark-color: #2E0B3D;
            --success-color: #4CAF50;
            --danger-color: #F44336;
            --warning-color: #FF9800;
            --info-color: #2196F3;
            --pix-color: #32CD32;
            --cash-color: #FFD700;
            --credit-color: #FF6347;
            --debit-color: #1E90FF;
            --delivery-color: #FF6B6B;
        }

        body {
            background-color: #f8f9fa;
            color: #333;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 10px;
        }

        .logo-image {
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-image img {
            height: 100%;
            width: auto;
            object-fit: contain;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.2));
        }

        .logo-text {
            text-align: left;
        }

        .logo-text h1 {
            margin: 0;
            font-size: 2.5rem;
            background: linear-gradient(to right, white, var(--accent-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .logo-text .subtitle {
            margin: 0;
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.9);
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 5px;
            margin-top: 15px;
        }

        .tab {
            padding: 10px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .tab.active {
            background-color: white;
            color: var(--primary-color);
        }

        .container {
            display: none;
            flex: 1;
            padding: 20px;
            gap: 20px;
            max-width: 1600px;
            margin: 0 auto;
            width: 100%;
        }

        .container.active {
            display: flex;
        }

        .pdv-container {
            display: flex;
            width: 100%;
            gap: 20px;
        }

        .products-section {
            flex: 2;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
        }

        .order-section {
            flex: 1;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
        }

        .expenses-section {
            flex: 1;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
        }

        .reports-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            width: 100%;
        }

        .section-title {
            color: var(--secondary-color);
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            color: var(--primary-color);
        }

        .category {
            margin-bottom: 30px;
        }

        .category-title {
            font-size: 1.3rem;
            color: var(--primary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .product-card {
            background: var(--light-color);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 150px;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(139, 0, 139, 0.1);
            border-color: var(--accent-color);
        }

        .product-card.selected {
            background-color: rgba(139, 0, 139, 0.1);
            border-color: var(--primary-color);
        }

        .product-icon {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .product-name {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 1.1rem;
        }

        .product-price {
            font-weight: 700;
            color: var(--secondary-color);
            font-size: 1.3rem;
        }

        .product-size {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .extras-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }

        .extra-item {
            background: var(--light-color);
            border-radius: 8px;
            padding: 15px;
            flex: 1;
            min-width: 120px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .extra-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.05);
            border-color: var(--accent-color);
        }

        .extra-item.selected {
            background-color: rgba(139, 0, 139, 0.1);
            border-color: var(--primary-color);
        }

        .extra-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .extra-price {
            color: var(--secondary-color);
            font-weight: 700;
        }

        .custom-value {
            background: var(--light-color);
            border-radius: 10px;
            padding: 20px;
            margin-top: 10px;
        }

        .input-group {
            display: flex;
            margin-bottom: 15px;
        }

        .input-group input, .input-group select {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px 0 0 8px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s;
        }

        .input-group input:focus, .input-group select:focus {
            border-color: var(--primary-color);
        }

        .input-group button {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 0 8px 8px 0;
            padding: 0 20px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }

        .input-group button:hover {
            background: var(--secondary-color);
        }

        .order-items {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
            max-height: 200px;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 10px;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .order-item:last-child {
            border-bottom: none;
        }

        .item-name {
            flex: 2;
            font-weight: 500;
        }

        .item-details {
            font-size: 0.8rem;
            color: #666;
            font-style: italic;
        }

        .item-price {
            flex: 1;
            text-align: right;
            font-weight: 600;
            color: var(--secondary-color);
        }

        .item-remove {
            color: var(--danger-color);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
            margin-left: 10px;
            padding: 5px;
            border-radius: 4px;
            transition: background 0.3s;
        }

        .item-remove:hover {
            background: rgba(244, 67, 54, 0.1);
        }

        .order-summary {
            background: var(--light-color);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .total {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            border-top: 2px solid var(--accent-color);
            padding-top: 10px;
            margin-top: 10px;
        }

        /* Área de Delivery */
        .delivery-section {
            background: var(--light-color);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
        }

        .delivery-section.active {
            display: block;
        }

        .delivery-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .delivery-btn {
            background-color: var(--delivery-color);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            flex: 1;
            justify-content: center;
        }

        .delivery-btn:hover {
            background-color: #ff5252;
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(255, 107, 107, 0.3);
        }

        .delivery-counter {
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            border: 2px solid var(--delivery-color);
            justify-content: center;
        }

        .delivery-count-controls {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .count-btn {
            background: var(--delivery-color);
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .count-btn:hover {
            background: #ff5252;
            transform: scale(1.1);
        }

        .count-btn.remove {
            background: var(--danger-color);
        }

        .count-btn.remove:hover {
            background: #d32f2f;
        }

        .delivery-count {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--delivery-color);
            min-width: 40px;
            text-align: center;
        }

        .delivery-total {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid var(--delivery-color);
            text-align: center;
        }

        .delivery-total-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }

        .delivery-total-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--delivery-color);
        }

        .delivery-driver-info {
            margin-top: 10px;
            padding: 10px;
            background: rgba(255, 107, 107, 0.1);
            border-radius: 8px;
            border-left: 4px solid var(--delivery-color);
            font-size: 0.9rem;
        }

        .delivery-driver-info strong {
            color: var(--delivery-color);
        }

        /* REMOVIDA Área de Formas de Pagamento fixa */
        .payment-methods {
            display: none;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: auto;
        }

        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .btn-register {
            background-color: var(--success-color);
            color: white;
        }

        .btn-register:hover {
            background-color: #3d8b40;
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(76, 175, 80, 0.3);
        }

        .btn-clear {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-clear:hover {
            background-color: #e68900;
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(255, 152, 0, 0.3);
        }

        .btn-cancel {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-cancel:hover {
            background-color: #d32f2f;
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(244, 67, 54, 0.3);
        }

        .btn-add-expense {
            background-color: var(--info-color);
            color: white;
            padding: 10px 15px;
            font-size: 0.9rem;
        }

        .expenses-container {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
            max-height: 200px;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 10px;
        }

        .expense-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .expense-item:last-child {
            border-bottom: none;
        }

        .expense-name {
            flex: 2;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .expense-value {
            flex: 1;
            text-align: right;
            font-weight: 600;
            color: var(--danger-color);
            font-size: 0.9rem;
        }

        .expense-remove {
            color: var(--danger-color);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            margin-left: 5px;
            padding: 3px;
            border-radius: 4px;
            transition: background 0.3s;
        }

        .expense-remove:hover {
            background: rgba(244, 67, 54, 0.1);
        }

        .report-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .report-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .btn-export-csv {
            background-color: var(--success-color);
            color: white;
        }

        .btn-export-txt {
            background-color: var(--info-color);
            color: white;
        }

        .btn-export-monthly {
            background-color: var(--accent-color);
            color: white;
        }

        .btn-clear-all {
            background-color: var(--danger-color);
            color: white;
        }

        .report-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }

        .monthly-filter {
            background: var(--light-color);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
        }

        .monthly-filter.active {
            display: block;
        }

        .filter-row {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .filter-row label {
            font-weight: 600;
            color: var(--secondary-color);
            min-width: 100px;
        }

        .filter-row select {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
            min-width: 200px;
        }

        .filter-row button {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }

        .filter-row button:hover {
            background: var(--secondary-color);
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--light-color);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .stat-title {
            font-size: 1rem;
            color: var(--secondary-color);
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .expense-form {
            background: var(--light-color);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--secondary-color);
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .expenses-list-container {
            overflow-x: auto;
            margin-bottom: 30px;
            border-radius: 8px;
            border: 1px solid #eee;
        }

        .expenses-table {
            width: 100%;
            border-collapse: collapse;
        }

        .expenses-table th {
            background-color: var(--primary-color);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .expenses-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        .expenses-table tr:hover {
            background-color: #f9f9f9;
        }

        .expenses-table tr:last-child td {
            border-bottom: none;
        }

        .expense-type {
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .expense-type.supplies {
            background-color: rgba(255, 152, 0, 0.2);
            color: #e68900;
        }

        .expense-type.rent {
            background-color: rgba(156, 39, 176, 0.2);
            color: #7b1fa2;
        }

        .expense-type.utilities {
            background-color: rgba(33, 150, 243, 0.2);
            color: #1565c0;
        }

        .expense-type.other {
            background-color: rgba(158, 158, 158, 0.2);
            color: #616161;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #777;
            font-size: 1.1rem;
        }

        .no-data i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #ddd;
        }

        .financial-summary {
            background: var(--light-color);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .financial-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .financial-total {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            border-top: 2px solid var(--accent-color);
            padding-top: 10px;
            margin-top: 10px;
        }

        .positive {
            color: var(--success-color);
        }

        .negative {
            color: var(--danger-color);
        }

        /* Modal de Senha */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: white;
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-title {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 20px;
            transition: border-color 0.3s;
        }

        .modal-input:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn-confirm {
            background-color: var(--danger-color);
            color: white;
        }

        .modal-btn-confirm:hover {
            background-color: #d32f2f;
        }

        .modal-btn-cancel {
            background-color: #ddd;
            color: #333;
        }

        .modal-btn-cancel:hover {
            background-color: #ccc;
        }

        footer {
            background-color: var(--dark-color);
            color: white;
            text-align: center;
            padding: 1rem;
            margin-top: auto;
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--success-color);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }

        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* Pedido Impresso - MODIFICADO: agora é apenas a visualização */
        .printed-order-section {
            background: var(--light-color);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border: 2px dashed var(--primary-color);
        }

        .printed-order {
            background: white;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
            border: 1px solid #ddd;
        }

        .printed-order-header {
            text-align: center;
            font-weight: bold;
            border-bottom: 1px dashed #000;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .printed-order-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .printed-order-footer {
            border-top: 1px dashed #000;
            padding-top: 10px;
            margin-top: 10px;
            text-align: center;
            font-weight: bold;
        }

        /* Modal de Delivery */
        .delivery-modal {
            max-width: 500px;
        }

        .delivery-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .delivery-option {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .delivery-option:hover {
            border-color: var(--delivery-color);
            background-color: rgba(255, 107, 107, 0.05);
        }

        .delivery-option.selected {
            border-color: var(--delivery-color);
            background-color: rgba(255, 107, 107, 0.1);
        }

        .delivery-option-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--delivery-color);
        }

        .delivery-option-description {
            font-size: 0.9rem;
            color: #666;
        }

        /* Modal de Sabores - SIMPLIFICADO */
        .flavors-modal {
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .flavors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .flavor-card {
            background: var(--light-color);
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            text-align: center;
        }

        .flavor-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            border-color: var(--accent-color);
        }

        .flavor-card.selected {
            background-color: rgba(139, 0, 139, 0.1);
            border-color: var(--primary-color);
        }

        .flavor-name {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        /* Modal de Entregador */
        .driver-modal {
            max-width: 400px;
        }

        /* Modal de Confirmação de Delivery */
        .delivery-confirmation-modal {
            max-width: 500px;
        }

        .delivery-question {
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.2rem;
            color: var(--secondary-color);
        }

        .delivery-question-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }

        .delivery-question-btn {
            flex: 1;
            padding: 20px;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .delivery-question-btn.yes {
            background-color: var(--delivery-color);
            color: white;
        }

        .delivery-question-btn.yes:hover {
            background-color: #ff5252;
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(255, 107, 107, 0.3);
        }

        .delivery-question-btn.no {
            background-color: var(--success-color);
            color: white;
        }

        .delivery-question-btn.no:hover {
            background-color: #3d8b40;
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(76, 175, 80, 0.3);
        }

        /* Informações do Dia */
        .day-info {
            background: var(--light-color);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary-color);
        }

        .day-info h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .day-stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
        }

        .day-stat {
            background: white;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }

        .day-stat-label {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 5px;
        }

        .day-stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        /* Modal de Pagamento (NOVO) */
        .payment-modal {
            max-width: 500px;
        }

        .payment-options-modal {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 25px;
        }

        .payment-option-modal {
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
        }

        .payment-option-modal:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }

        .payment-option-modal.selected {
            border-color: var(--primary-color);
            background-color: rgba(139, 0, 139, 0.05);
        }

        .payment-option-modal.pix {
            border-color: var(--pix-color);
            color: var(--pix-color);
        }

        .payment-option-modal.pix.selected {
            background-color: rgba(50, 205, 50, 0.1);
        }

        .payment-option-modal.cash {
            border-color: var(--cash-color);
            color: var(--cash-color);
        }

        .payment-option-modal.cash.selected {
            background-color: rgba(255, 215, 0, 0.1);
        }

        .payment-option-modal.credit {
            border-color: var(--credit-color);
            color: var(--credit-color);
        }

        .payment-option-modal.credit.selected {
            background-color: rgba(255, 99, 71, 0.1);
        }

        .payment-option-modal.debit {
            border-color: var(--debit-color);
            color: var(--debit-color);
        }

        .payment-option-modal.debit.selected {
            background-color: rgba(30, 144, 255, 0.1);
        }

        .payment-confirmation-modal {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        /* Modal de Confirmação de Impressão (NOVO) */
        .print-confirmation-modal {
            max-width: 400px;
        }

        .print-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .print-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }

        .print-btn.yes {
            background-color: var(--success-color);
            color: white;
        }

        .print-btn.yes:hover {
            background-color: #3d8b40;
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(76, 175, 80, 0.3);
        }

        .print-btn.no {
            background-color: var(--warning-color);
            color: white;
        }

        .print-btn.no:hover {
            background-color: #e68900;
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(255, 152, 0, 0.3);
        }

        @media (max-width: 1024px) {
            .pdv-container {
                flex-direction: column;
            }
        }

        @media (max-width: 768px) {
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-direction: column;
                align-items: center;
            }
            
            .tab {
                width: 100%;
                justify-content: center;
            }
            
            .logo {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .logo-text {
                text-align: center;
            }
            
            .logo-image {
                height: 60px;
            }
            
            .logo-text h1 {
                font-size: 2rem;
            }
            
            .report-controls {
                flex-direction: column;
            }
            
            .filter-row {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .filter-row select {
                width: 100%;
            }
            
            .payment-options-modal {
                grid-template-columns: 1fr;
            }
            
            .payment-confirmation-modal {
                flex-direction: column;
            }
            
            .delivery-controls {
                flex-direction: column;
            }
            
            .delivery-counter {
                flex-direction: column;
                gap: 10px;
            }
            
            .flavors-grid {
                grid-template-columns: 1fr;
            }
            
            .delivery-question-buttons {
                flex-direction: column;
            }
            
            .day-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .print-buttons {
                flex-direction: column;
            }
        }
        
        @media (max-width: 480px) {
            .logo-text h1 {
                font-size: 1.8rem;
            }
            
            .logo-image {
                height: 50px;
            }
            
            .modal {
                padding: 20px;
                width: 95%;
            }
            
            .day-stats {
                grid-template-columns: 1fr;
            }
            
            .payment-option-modal {
                padding: 15px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <div class="logo-image">
                <img src="Quero mais logo.png" alt="Logo Quero Mais Açaí" onerror="this.onerror=null; this.src='https://via.placeholder.com/200x70/8B008B/FFFFFF?text=Quero+Mais+Açaí'; this.alt='Logo Quero Mais Açaí (placeholder)';">
            </div>
            <div class="logo-text">
                <h1>Quero Mais Açaí</h1>
                <p class="subtitle">Sistema PDV - Controle de Vendas e Delivery</p>
            </div>
        </div>
        <div class="nav-tabs">
            <div class="tab active" data-tab="pdv">
                <i class="fas fa-cash-register"></i>
                PDV
            </div>
            <div class="tab" data-tab="reports">
                <i class="fas fa-chart-bar"></i>
                Relatórios
            </div>
        </div>
    </header>

    <div class="container active" id="pdv-container">
        <div class="pdv-container">
            <section class="products-section">
                <h2 class="section-title"><i class="fas fa-store"></i> Produtos</h2>
                
                <!-- Informações do Dia -->
                <div class="day-info">
                    <h3><i class="fas fa-calendar-day"></i> Informações do Dia</h3>
                    <div class="day-stats">
                        <div class="day-stat">
                            <div class="day-stat-label">Vendas Hoje</div>
                            <div class="day-stat-value" id="today-sales-count">0</div>
                        </div>
                        <div class="day-stat">
                            <div class="day-stat-label">Valor Hoje</div>
                            <div class="day-stat-value" id="today-sales-amount">R$ 0,00</div>
                        </div>
                        <div class="day-stat">
                            <div class="day-stat-label">Delivery Hoje</div>
                            <div class="day-stat-value" id="today-delivery-count">0</div>
                        </div>
                        <div class="day-stat">
                            <div class="day-stat-label">Saídas Hoje</div>
                            <div class="day-stat-value" id="today-expenses-amount">R$ 0,00</div>
                        </div>
                    </div>
                </div>
                
                <div class="category">
                    <h3 class="category-title"><i class="fas fa-glass-whiskey"></i> Copos de Açaí</h3>
                    <div class="products-grid" id="acai-products">
                        <!-- Produtos serão inseridos via JavaScript -->
                    </div>
                </div>
                
                <div class="category">
                    <h3 class="category-title"><i class="fas fa-plus-circle"></i> Adicionais</h3>
                    <div class="extras-container" id="adicionais">
                        <!-- Adicionais serão inseridos via JavaScript -->
                    </div>
                </div>
                
                <div class="category">
                    <h3 class="category-title"><i class="fas fa-wine-bottle"></i> Bebidas</h3>
                    <div class="extras-container" id="bebidas">
                        <!-- Bebidas serão inseridos via JavaScript -->
                    </div>
                </div>
                
                <div class="category">
                    <h3 class="category-title"><i class="fas fa-receipt"></i> Valor Avulso</h3>
                    <div class="custom-value">
                        <p>Vendas no quilo e outros</p>
                        <div class="input-group">
                            <input type="number" id="custom-value-input" placeholder="Valor em R$" min="0" step="0.01">
                            <button id="add-custom-value">Adicionar</button>
                        </div>
                        <div class="input-group">
                            <input type="text" id="custom-description" placeholder="Descrição do item">
                        </div>
                    </div>
                </div>

                <!-- Área de Pedido Impresso (agora apenas visualização) -->
                <div class="printed-order-section">
                    <h3 class="category-title"><i class="fas fa-print"></i> Pedido para Cozinha</h3>
                    <div class="printed-order" id="printed-order">
                        <div class="printed-order-header">
                            QUERO MAIS AÇAÍ<br>
                            PEDIDO PARA COZINHA<br>
                            --------------------
                        </div>
                        <div id="printed-order-items">
                            <!-- Itens do pedido impresso serão inseridos aqui -->
                        </div>
                        <div class="printed-order-footer" id="printed-order-footer">
                            Aguardando pedido...
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-register" id="print-order">
                            <i class="fas fa-print"></i> Imprimir Pedido
                        </button>
                        <button class="btn btn-clear" id="clear-printed-order">
                            <i class="fas fa-broom"></i> Limpar
                        </button>
                    </div>
                </div>
            </section>
            
            <section class="order-section">
                <h2 class="section-title"><i class="fas fa-shopping-cart"></i> Pedido Atual</h2>
                
                <div class="order-items" id="order-items">
                    <p class="empty-order-message" id="empty-order-message">Nenhum item adicionado ao pedido.</p>
                </div>
                
                <div class="order-summary">
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">R$ 0,00</span>
                    </div>
                    <div class="summary-row total">
                        <span>Total:</span>
                        <span id="total">R$ 0,00</span>
                    </div>
                </div>
                
                <!-- Área de Delivery (agora só aparece após confirmação da venda) -->
                <div class="delivery-section" id="delivery-section">
                    <h3 class="category-title"><i class="fas fa-motorcycle"></i> Controle de Delivery</h3>
                    <p style="margin-bottom: 15px; color: #666; font-size: 0.9rem;">
                        <i class="fas fa-info-circle"></i> Taxa padrão: R$ 4,00 por entrega
                    </p>
                    
                    <div class="delivery-controls">
                        <button class="delivery-btn" id="add-delivery-modal-btn">
                            <i class="fas fa-plus-circle"></i> Adicionar Delivery
                        </button>
                        <div class="delivery-counter">
                            <i class="fas fa-motorcycle"></i>
                            <div class="delivery-count-controls">
                                <button class="count-btn remove" id="remove-delivery">-</button>
                                <span class="delivery-count" id="delivery-count">0</span>
                                <button class="count-btn" id="add-delivery-quick">+</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="delivery-total">
                        <div class="delivery-total-label">Total em Delivery</div>
                        <div class="delivery-total-value" id="delivery-total">R$ 0,00</div>
                    </div>
                    
                    <div id="delivery-driver-display" class="delivery-driver-info" style="display: none;">
                        <strong>Entregador:</strong> <span id="current-driver-name">Não definido</span>
                    </div>
                    
                    <div class="action-buttons" style="margin-top: 15px;">
                        <button class="btn btn-register" id="finish-delivery">
                            <i class="fas fa-check-circle"></i> Finalizar Delivery
                        </button>
                        <button class="btn btn-cancel" id="skip-delivery">
                            <i class="fas fa-times-circle"></i> Pular
                        </button>
                    </div>
                </div>
                
                <!-- Área de Saídas (Despesas do Dia) -->
                <div class="expenses-section">
                    <h2 class="section-title"><i class="fas fa-sign-out-alt"></i> Saídas do Dia</h2>
                    
                    <div class="expenses-container" id="expenses-container">
                        <p class="empty-expense-message" id="empty-expense-message">Nenhuma saída registrada hoje.</p>
                    </div>
                    
                    <div class="input-group">
                        <input type="number" id="expense-value-input" placeholder="Valor em R$" min="0" step="0.01">
                        <button id="add-expense-value">+</button>
                    </div>
                    <div class="input-group">
                        <input type="text" id="expense-description" placeholder="Descrição da saída">
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-register" id="register-order">
                        <i class="fas fa-check-circle"></i> Registrar Venda
                    </button>
                    <button class="btn btn-clear" id="clear-order">
                        <i class="fas fa-broom"></i> Limpar Pedido
                    </button>
                    <button class="btn btn-cancel" id="cancel-order">
                        <i class="fas fa-times-circle"></i> Cancelar
                    </button>
                </div>
            </section>
        </div>
    </div>

    <div class="container" id="reports-container">
        <section class="reports-section">
            <h2 class="section-title"><i class="fas fa-chart-bar"></i> Relatório Completo de Vendas e Delivery</h2>
            
            <div class="report-controls">
                <button class="report-btn btn-export-csv" id="export-csv">
                    <i class="fas fa-file-csv"></i> Exportar CSV Completo
                </button>
                <button class="report-btn btn-export-txt" id="export-txt">
                    <i class="fas fa-file-alt"></i> Exportar TXT Completo
                </button>
                <button class="report-btn btn-export-monthly" id="export-monthly">
                    <i class="fas fa-calendar-alt"></i> Relatório Mensal
                </button>
                <button class="report-btn btn-clear-all" id="clear-all-sales">
                    <i class="fas fa-trash-alt"></i> Limpar Histórico
                </button>
            </div>
            
            <!-- Filtro por Mês -->
            <div class="monthly-filter" id="monthly-filter">
                <h3 class="section-title"><i class="fas fa-filter"></i> Filtrar por Mês</h3>
                <div class="filter-row">
                    <label for="month-select">Mês:</label>
                    <select id="month-select">
                        <option value="0">Janeiro</option>
                        <option value="1">Fevereiro</option>
                        <option value="2">Março</option>
                        <option value="3">Abril</option>
                        <option value="4">Maio</option>
                        <option value="5">Junho</option>
                        <option value="6">Julho</option>
                        <option value="7">Agosto</option>
                        <option value="8">Setembro</option>
                        <option value="9">Outubro</option>
                        <option value="10">Novembro</option>
                        <option value="11">Dezembro</option>
                    </select>
                    <label for="year-select">Ano:</label>
                    <select id="year-select">
                        <!-- Anos serão preenchidos via JavaScript -->
                    </select>
                    <button id="apply-monthly-filter">
                        <i class="fas fa-check"></i> Aplicar Filtro
                    </button>
                    <button id="export-monthly-report">
                        <i class="fas fa-download"></i> Exportar Relatório Mensal
                    </button>
                </div>
            </div>
            
            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-title">Total de Vendas</div>
                    <div class="stat-value" id="total-sales-count">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Valor Total Vendido</div>
                    <div class="stat-value" id="total-sales-amount">R$ 0,00</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Total de Delivery</div>
                    <div class="stat-value" id="total-delivery-amount">R$ 0,00</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Total de Despesas</div>
                    <div class="stat-value" id="total-expenses-amount">R$ 0,00</div>
                </div>
            </div>
            
            <!-- Resumo Financeiro -->
            <div class="financial-summary">
                <h3 class="category-title"><i class="fas fa-balance-scale"></i> Balanço Financeiro</h3>
                <div class="financial-row">
                    <span>Total de Vendas (sem delivery):</span>
                    <span id="total-revenue-no-delivery">R$ 0,00</span>
                </div>
                <div class="financial-row">
                    <span>Total com Delivery:</span>
                    <span id="total-revenue-with-delivery">R$ 0,00</span>
                </div>
                <div class="financial-row">
                    <span>Total de Despesas:</span>
                    <span id="total-expenses" class="negative">R$ 0,00</span>
                </div>
                <div class="financial-row">
                    <span>Forma de Pagamento Mais Usada:</span>
                    <span id="most-used-payment">-</span>
                </div>
                <div class="financial-row">
                    <span>Total de Entregas Realizadas:</span>
                    <span id="total-deliveries">0</span>
                </div>
                <div class="financial-row financial-total">
                    <span>Lucro Líquido (sem delivery):</span>
                    <span id="total-profit-no-delivery">R$ 0,00</span>
                </div>
                <div class="financial-row financial-total">
                    <span>Lucro Líquido (com delivery):</span>
                    <span id="total-profit-with-delivery">R$ 0,00</span>
                </div>
            </div>
            
            <div class="sales-table-container">
                <table class="sales-table" id="sales-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Data/Hora</th>
                            <th>Itens</th>
                            <th>Valor</th>
                            <th>Pagamento</th>
                            <th>Delivery</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="sales-table-body">
                        <!-- Vendas serão inseridas aqui via JavaScript -->
                    </tbody>
                </table>
                <div class="no-data" id="no-sales-message">
                    <i class="fas fa-clipboard-list"></i>
                    <p>Nenhuma venda registrada ainda.</p>
                </div>
            </div>
        </section>
    </div>
    
    <!-- Modal de Proteção por Senha -->
    <div class="modal-overlay" id="password-modal">
        <div class="modal">
            <h3 class="modal-title">
                <i class="fas fa-lock"></i> Proteção por Senha
            </h3>
            <p style="margin-bottom: 20px; color: #666;" id="password-modal-message">
                Para esta ação, digite a senha de administrador:
            </p>
            <input type="password" class="modal-input" id="admin-password" placeholder="Digite a senha">
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-confirm" id="confirm-password">
                    Confirmar
                </button>
                <button class="modal-btn modal-btn-cancel" id="cancel-password">
                    Cancelar
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal de Delivery -->
    <div class="modal-overlay" id="delivery-modal">
        <div class="modal delivery-modal">
            <h3 class="modal-title">
                <i class="fas fa-motorcycle"></i> Adicionar Delivery
            </h3>
            <div class="delivery-options">
                <div class="delivery-option" id="standard-delivery">
                    <div class="delivery-option-title">Entrega Padrão</div>
                    <div class="delivery-option-description">Taxa de R$ 4,00 por entrega</div>
                </div>
                <div class="delivery-option" id="custom-delivery">
                    <div class="delivery-option-title">Entrega com Valor Personalizado</div>
                    <div class="delivery-option-description">Defina o valor da entrega</div>
                </div>
            </div>
            <div id="custom-delivery-fields" style="display: none;">
                <div class="form-group">
                    <label for="custom-delivery-value">Valor da Entrega (R$):</label>
                    <input type="number" id="custom-delivery-value" min="0" step="0.01" placeholder="Ex: 5,00">
                </div>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-confirm" id="confirm-delivery">
                    Adicionar
                </button>
                <button class="modal-btn modal-btn-cancel" id="cancel-delivery">
                    Cancelar
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal de Sabores (SIMPLIFICADO) -->
    <div class="modal-overlay" id="flavors-modal">
        <div class="modal flavors-modal">
            <h3 class="modal-title">
                <i class="fas fa-ice-cream"></i> Escolha o Sabor do Açaí
            </h3>
            <p style="margin-bottom: 20px; color: #666;" id="selected-size-info">
                <!-- Tamanho selecionado será inserido aqui -->
            </p>
            <div class="flavors-grid" id="flavors-grid">
                <!-- Sabores serão inseridos via JavaScript -->
            </div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-confirm" id="confirm-flavor">
                    Adicionar ao Pedido
                </button>
                <button class="modal-btn modal-btn-cancel" id="cancel-flavor">
                    Cancelar
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal do Entregador -->
    <div class="modal-overlay" id="driver-modal">
        <div class="modal driver-modal">
            <h3 class="modal-title">
                <i class="fas fa-user"></i> Definir Entregador
            </h3>
            <p style="margin-bottom: 20px; color: #666;">
                Informe o nome do entregador para as entregas de hoje:
            </p>
            <div class="form-group">
                <input type="text" class="modal-input" id="driver-name-input" placeholder="Nome do entregador" autofocus>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-confirm" id="confirm-driver">
                    Confirmar
                </button>
                <button class="modal-btn modal-btn-cancel" id="cancel-driver">
                    Pular
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal de Confirmação de Delivery -->
    <div class="modal-overlay" id="delivery-confirmation-modal">
        <div class="modal delivery-confirmation-modal">
            <h3 class="modal-title">
                <i class="fas fa-motorcycle"></i> Esta venda é um delivery?
            </h3>
            <div class="delivery-question">
                Após confirmar o pagamento, informe se é para entrega
            </div>
            <div class="delivery-question-buttons">
                <button class="delivery-question-btn yes" id="delivery-yes">
                    <i class="fas fa-motorcycle"></i>
                    <span>SIM, é delivery</span>
                </button>
                <button class="delivery-question-btn no" id="delivery-no">
                    <i class="fas fa-store"></i>
                    <span>NÃO, é retirada</span>
                </button>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" id="cancel-delivery-confirmation">
                    Cancelar
                </button>
            </div>
        </div>
    </div>
    
    <!-- NOVO: Modal de Pagamento (Popup) -->
    <div class="modal-overlay" id="payment-modal">
        <div class="modal payment-modal">
            <h3 class="modal-title">
                <i class="fas fa-credit-card"></i> Forma de Pagamento
            </h3>
            <p style="margin-bottom: 20px; color: #666;">
                Selecione a forma de pagamento para a venda:
            </p>
            
            <div class="payment-options-modal">
                <div class="payment-option-modal pix" data-method="pix">
                    <i class="fas fa-qrcode"></i>
                    <span>PIX</span>
                </div>
                <div class="payment-option-modal cash" data-method="dinheiro">
                    <i class="fas fa-money-bill-wave"></i>
                    <span>Dinheiro</span>
                </div>
                <div class="payment-option-modal credit" data-method="credito">
                    <i class="fas fa-credit-card"></i>
                    <span>Crédito</span>
                </div>
                <div class="payment-option-modal debit" data-method="debito">
                    <i class="fas fa-credit-card"></i>
                    <span>Débito</span>
                </div>
            </div>
            
            <div class="payment-confirmation-modal">
                <button class="modal-btn modal-btn-confirm" id="confirm-payment-modal">
                    <i class="fas fa-check-circle"></i> CONFIRMAR VENDA
                </button>
                <button class="modal-btn modal-btn-cancel" id="cancel-payment-modal">
                    <i class="fas fa-times-circle"></i> CANCELAR
                </button>
            </div>
        </div>
    </div>
    
    <!-- NOVO: Modal de Confirmação de Impressão -->
    <div class="modal-overlay" id="print-confirmation-modal">
        <div class="modal print-confirmation-modal">
            <h3 class="modal-title">
                <i class="fas fa-print"></i> Imprimir Pedido?
            </h3>
            <p style="margin-bottom: 25px; text-align: center; color: #666;">
                Deseja imprimir o pedido para a cozinha?
            </p>
            <div class="print-buttons">
                <button class="print-btn yes" id="confirm-print">
                    <i class="fas fa-print"></i> SIM, Imprimir
                </button>
                <button class="print-btn no" id="cancel-print">
                    <i class="fas fa-times"></i> NÃO, Obrigado
                </button>
            </div>
        </div>
    </div>
    
    <footer>
        <p>Sistema PDV Açaiteria &copy; 2023 - Controle Completo de Vendas e Delivery</p>
    </footer>
    
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notification-text">Venda registrada com sucesso!</span>
    </div>

    <script>
        // Dados dos produtos
        const products = {
            acai: [
                { id: 1, name: "Açaí 330ml", price: 17.00, icon: "fa-glass-whiskey", size: "P", ml: "330ml" },
                { id: 2, name: "Açaí 440ml", price: 19.00, icon: "fa-glass-whiskey", size: "M", ml: "440ml" },
                { id: 3, name: "Açaí 550ml", price: 22.00, icon: "fa-glass-whiskey", size: "G", ml: "550ml" }
            ],
            adicionais: [
                { id: 4, name: "Adicional 1", price: 2.50, icon: "fa-plus-circle" },
                { id: 5, name: "Adicional 2", price: 3.00, icon: "fa-plus-circle" },
                { id: 6, name: "Adicional 3", price: 4.00, icon: "fa-plus-circle" }
            ],
            bebidas: [
                { id: 7, name: "Agua sem gás", price: 3.00, icon: "fa-wine-bottle" },
                { id: 8, name: "Agua com gás", price: 4.00, icon: "fa-wine-bottle" },
                { id: 9, name: "Refri lata", price: 6.00, icon: "fa-wine-bottle" }
            ]
        };

        // Sabores do cardápio (SIMPLIFICADO)
        const flavors = [
            { id: 1, name: "Açaí Tropical" },
            { id: 2, name: "Açaí Sonho de Valsa" },
            { id: 3, name: "Açaí Kids" },
            { id: 4, name: "Açaí Bis" },
            { id: 5, name: "Açaí Nutella" },
            { id: 6, name: "Açaí Láctea" },
            { id: 7, name: "Açaí Paçoca" },
            { id: 8, name: "Açaí Amendoim" },
            { id: 9, name: "Açaí Chocolate" },
            { id: 10, name: "Açaí Nutella com Morango" }
        ];

        // Formas de pagamento
        const paymentMethods = {
            pix: { name: "PIX", color: "var(--pix-color)", icon: "fa-qrcode" },
            dinheiro: { name: "Dinheiro", color: "var(--cash-color)", icon: "fa-money-bill-wave" },
            credito: { name: "Cartão Crédito", color: "var(--credit-color)", icon: "fa-credit-card" },
            debito: { name: "Cartão Débito", color: "var(--debit-color)", icon: "fa-credit-card" }
        };

        // Configurações do delivery
        const STANDARD_DELIVERY_FEE = 4.00;

        // Estado do sistema
        let currentOrder = [];
        let dailyExpenses = [];
        let deliveryCount = 0;
        let deliveryTotalValue = 0;
        let deliveryFee = STANDARD_DELIVERY_FEE;
        let deliveryDriverName = "";
        let orderCounter = 1;
        let currentMonthFilter = null;
        let selectedPaymentMethod = null;
        let currentModalAction = null;
        let currentSaleToCancel = null;
        let selectedAcaiSize = null;
        let selectedFlavor = null;
        let currentSale = null;
        let isDeliveryFlow = false;
        let pendingPrintOrder = null; // CORREÇÃO: Variável para armazenar pedido pendente de impressão

        // Configurações de segurança
        const ADMIN_PASSWORD = "admin123";
        const MONTH_NAMES = [
            "Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho",
            "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"
        ];

        // Chave para armazenar a última data de reset
        const LAST_RESET_KEY = "last_reset_date";

        // Formatar valor para Real brasileiro
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value);
        }

        // Formatar data para exibição
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR') + ' ' + date.toLocaleTimeString('pt-BR');
        }

        // Verificar e resetar dados diários
        function checkAndResetDailyData() {
            const today = new Date().toDateString();
            const lastReset = localStorage.getItem(LAST_RESET_KEY);
            
            if (lastReset !== today) {
                // Resetar dados do PDV (mas manter histórico)
                currentOrder = [];
                dailyExpenses = [];
                deliveryCount = 0;
                deliveryTotalValue = 0;
                deliveryFee = STANDARD_DELIVERY_FEE;
                deliveryDriverName = "";
                
                // Limpar localStorage do dia
                localStorage.removeItem('daily_expenses');
                localStorage.removeItem('delivery_count');
                localStorage.removeItem('delivery_total');
                localStorage.removeItem('delivery_fee');
                localStorage.removeItem('delivery_driver');
                localStorage.removeItem('today_sales');
                
                // Salvar data do reset
                localStorage.setItem(LAST_RESET_KEY, today);
                
                // Atualizar interface
                renderOrderItems();
                updateOrderSummary();
                renderDailyExpenses();
                updateDeliveryDisplay();
                updatePrintedOrder();
                updateDayInfo();
                
                console.log("Dados diários resetados para novo dia");
            }
        }

        // Atualizar informações do dia
        function updateDayInfo() {
            const today = new Date().toLocaleDateString('pt-BR');
            
            // Vendas de hoje
            const todaySales = JSON.parse(localStorage.getItem('today_sales') || '[]');
            const todaySalesCount = todaySales.length;
            const todaySalesAmount = todaySales.reduce((sum, sale) => sum + sale.total, 0);
            
            // Deliveries de hoje
            const deliveries = JSON.parse(localStorage.getItem('deliveries') || '[]');
            const todayDeliveries = deliveries.filter(d => {
                const deliveryDate = new Date(d.date).toLocaleDateString('pt-BR');
                return deliveryDate === today;
            });
            const todayDeliveryCount = todayDeliveries.reduce((sum, d) => sum + d.count, 0);
            
            // Despesas de hoje
            const todayExpenses = JSON.parse(localStorage.getItem('daily_expenses') || '[]');
            const todayExpensesAmount = todayExpenses.reduce((sum, expense) => sum + expense.value, 0);
            
            document.getElementById('today-sales-count').textContent = todaySalesCount;
            document.getElementById('today-sales-amount').textContent = formatCurrency(todaySalesAmount);
            document.getElementById('today-delivery-count').textContent = todayDeliveryCount;
            document.getElementById('today-expenses-amount').textContent = formatCurrency(todayExpensesAmount);
        }

        // Atualizar o resumo do pedido
        function updateOrderSummary() {
            const subtotal = currentOrder.reduce((sum, item) => sum + item.price, 0);
            const total = subtotal;
            
            document.getElementById('subtotal').textContent = formatCurrency(subtotal);
            document.getElementById('total').textContent = formatCurrency(total);
            
            const emptyOrderMessage = document.getElementById('empty-order-message');
            if (currentOrder.length === 0) {
                emptyOrderMessage.style.display = 'block';
            } else {
                emptyOrderMessage.style.display = 'none';
            }
            
            // Atualizar pedido impresso
            updatePrintedOrder();
        }

        // Atualizar contador de delivery
        function updateDeliveryDisplay() {
            const deliveryTotal = deliveryCount * deliveryFee;
            deliveryTotalValue = deliveryTotal;
            
            document.getElementById('delivery-count').textContent = deliveryCount;
            document.getElementById('delivery-total').textContent = formatCurrency(deliveryTotal);
            
            // Mostrar/ocultar info do entregador
            const driverDisplay = document.getElementById('delivery-driver-display');
            const driverNameSpan = document.getElementById('current-driver-name');
            
            if (deliveryDriverName) {
                driverNameSpan.textContent = deliveryDriverName;
                driverDisplay.style.display = 'block';
            } else {
                driverDisplay.style.display = 'none';
            }
            
            // Salvar no localStorage
            localStorage.setItem('delivery_count', deliveryCount.toString());
            localStorage.setItem('delivery_total', deliveryTotal.toString());
            localStorage.setItem('delivery_fee', deliveryFee.toString());
            if (deliveryDriverName) {
                localStorage.setItem('delivery_driver', deliveryDriverName);
            }
        }

        // Verificar se precisa pedir nome do entregador
        function checkDriverName() {
            const deliveries = JSON.parse(localStorage.getItem('deliveries') || '[]');
            const today = new Date().toLocaleDateString('pt-BR');
            const todayDeliveries = deliveries.filter(d => {
                const deliveryDate = new Date(d.date).toLocaleDateString('pt-BR');
                return deliveryDate === today;
            });
            
            // Se não tem entregador definido e é a primeira entrega do dia
            if (!deliveryDriverName && todayDeliveries.length === 0 && deliveryCount === 0) {
                showDriverModal();
                return true;
            }
            return false;
        }

        // Adicionar entrega
        function addDelivery(customFee = null, isCustom = false) {
            // Verificar se precisa pedir nome do entregador
            if (checkDriverName()) {
                // Adicionar depois que o usuário definir o nome
                return; 
            }
            
            if (customFee !== null) {
                deliveryFee = customFee;
            } else {
                deliveryFee = STANDARD_DELIVERY_FEE;
            }
            
            deliveryCount++;
            updateDeliveryDisplay();
            
            showNotification(`Delivery adicionado! Total: ${deliveryCount} entrega(s)`);
        }

        // Remover entrega
        function removeDelivery() {
            if (deliveryCount > 0) {
                deliveryCount--;
                
                updateDeliveryDisplay();
                showNotification(`Delivery removido! Total: ${deliveryCount} entrega(s)`);
            } else {
                showNotification("Não há entregas para remover!", "warning");
            }
        }

        // Mostrar modal de delivery
        function showDeliveryModal() {
            document.getElementById('delivery-modal').classList.add('active');
            document.getElementById('standard-delivery').classList.add('selected');
            document.getElementById('custom-delivery').classList.remove('selected');
            document.getElementById('custom-delivery-fields').style.display = 'none';
        }

        // Fechar modal de delivery
        function closeDeliveryModal() {
            document.getElementById('delivery-modal').classList.remove('active');
            document.getElementById('custom-delivery-value').value = '';
        }

        // Mostrar modal do entregador
        function showDriverModal() {
            document.getElementById('driver-modal').classList.add('active');
        }

        // Fechar modal do entregador
        function closeDriverModal() {
            document.getElementById('driver-modal').classList.remove('active');
            document.getElementById('driver-name-input').value = '';
        }

        // Mostrar modal de confirmação de delivery
        function showDeliveryConfirmationModal() {
            document.getElementById('delivery-confirmation-modal').classList.add('active');
        }

        // Fechar modal de confirmação de delivery
        function closeDeliveryConfirmationModal() {
            document.getElementById('delivery-confirmation-modal').classList.remove('active');
        }

        // MOSTRAR MODAL DE PAGAMENTO (NOVO)
        function showPaymentModal() {
            selectedPaymentMethod = null;
            
            // Limpar seleção anterior
            document.querySelectorAll('.payment-option-modal').forEach(option => {
                option.classList.remove('selected');
            });
            
            document.getElementById('payment-modal').classList.add('active');
        }

        // FECHAR MODAL DE PAGAMENTO (NOVO)
        function closePaymentModal() {
            document.getElementById('payment-modal').classList.remove('active');
        }

        // MOSTRAR MODAL DE CONFIRMAÇÃO DE IMPRESSÃO (NOVO)
        function showPrintConfirmationModal() {
            document.getElementById('print-confirmation-modal').classList.add('active');
        }

        // FECHAR MODAL DE CONFIRMAÇÃO DE IMPRESSÃO (NOVO)
        function closePrintConfirmationModal() {
            document.getElementById('print-confirmation-modal').classList.remove('active');
        }

        // Adicionar item ao pedido
        function addToOrder(product) {
            const orderItem = {
                id: Date.now(),
                productId: product.id,
                name: product.name,
                price: product.price,
                details: product.flavor ? `Sabor: ${product.flavor}` : '',
                size: product.size,
                flavor: product.flavor
            };
            
            currentOrder.push(orderItem);
            renderOrderItems();
            updateOrderSummary();
            
            showNotification(`${product.name} adicionado ao pedido!`);
        }

        // Mostrar modal de sabores (SIMPLIFICADO)
        function showFlavorsModal(product) {
            selectedAcaiSize = product;
            document.getElementById('selected-size-info').textContent = 
                `Tamanho selecionado: ${product.size} - ${product.ml} - ${formatCurrency(product.price)}`;
            
            // Limpar seleção anterior
            selectedFlavor = null;
            document.querySelectorAll('.flavor-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            document.getElementById('flavors-modal').classList.add('active');
        }

        // Fechar modal de sabores
        function closeFlavorsModal() {
            document.getElementById('flavors-modal').classList.remove('active');
            selectedAcaiSize = null;
            selectedFlavor = null;
        }

        // Adicionar açaí com sabor ao pedido
        function addAcaiWithFlavor() {
            if (!selectedAcaiSize || !selectedFlavor) {
                showNotification("Selecione um sabor primeiro!", "error");
                return;
            }
            
            const orderItem = {
                id: Date.now(),
                productId: selectedAcaiSize.id,
                name: `${selectedAcaiSize.name} - ${selectedFlavor.name}`,
                price: selectedAcaiSize.price,
                details: `Sabor: ${selectedFlavor.name}`,
                size: selectedAcaiSize.size,
                flavor: selectedFlavor.name
            };
            
            currentOrder.push(orderItem);
            renderOrderItems();
            updateOrderSummary();
            
            showNotification(`${selectedAcaiSize.name} - ${selectedFlavor.name} adicionado ao pedido!`);
            closeFlavorsModal();
        }

        // Remover item do pedido
        function removeFromOrder(itemId) {
            const itemIndex = currentOrder.findIndex(item => item.id === itemId);
            if (itemIndex !== -1) {
                currentOrder.splice(itemIndex, 1);
                renderOrderItems();
                updateOrderSummary();
                showNotification("Item removido do pedido!");
            }
        }

        // Renderizar os itens do pedido
        function renderOrderItems() {
            const orderItemsContainer = document.getElementById('order-items');
            
            const itemsToRemove = orderItemsContainer.querySelectorAll('.order-item');
            itemsToRemove.forEach(item => item.remove());
            
            currentOrder.forEach(item => {
                const orderItemElement = document.createElement('div');
                orderItemElement.className = 'order-item';
                
                let itemNameHtml = `<span class="item-name">${item.name}</span>`;
                if (item.details) {
                    itemNameHtml += `<div class="item-details">${item.details}</div>`;
                }
                
                orderItemElement.innerHTML = `
                    <div style="flex: 2;">
                        ${itemNameHtml}
                    </div>
                    <span class="item-price">${formatCurrency(item.price)}</span>
                    <button class="item-remove" data-id="${item.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                
                orderItemsContainer.appendChild(orderItemElement);
            });
            
            document.querySelectorAll('.item-remove').forEach(button => {
                button.addEventListener('click', function() {
                    const itemId = parseInt(this.getAttribute('data-id'));
                    removeFromOrder(itemId);
                });
            });
        }

        // Atualizar pedido impresso
        function updatePrintedOrder() {
            const printedOrderItems = document.getElementById('printed-order-items');
            const printedOrderFooter = document.getElementById('printed-order-footer');
            
            printedOrderItems.innerHTML = '';
            
            if (currentOrder.length === 0) {
                printedOrderFooter.innerHTML = 'Aguardando pedido...';
                return;
            }
            
            currentOrder.forEach(item => {
                const line = document.createElement('div');
                line.className = 'printed-order-line';
                line.innerHTML = `
                    <span>${item.name}</span>
                    <span>${formatCurrency(item.price)}</span>
                `;
                printedOrderItems.appendChild(line);
                
                // Adicionar detalhes do sabor se for açaí
                if (item.details) {
                    const detailLine = document.createElement('div');
                    detailLine.className = 'printed-order-line';
                    detailLine.innerHTML = `
                        <span style="font-size: 0.9em; color: #666;">&nbsp;&nbsp;${item.details}</span>
                        <span></span>
                    `;
                    printedOrderItems.appendChild(detailLine);
                }
            });
            
            const subtotal = currentOrder.reduce((sum, item) => sum + item.price, 0);
            printedOrderFooter.innerHTML = `
                TOTAL: ${formatCurrency(subtotal)}<br>
                ${new Date().toLocaleDateString('pt-BR')} ${new Date().toLocaleTimeString('pt-BR').substring(0, 5)}<br>
                --------------------
            `;
        }

        // Registrar venda com forma de pagamento (MODIFICADO)
        function registerOrderWithPayment() {
            if (!selectedPaymentMethod) {
                showNotification("Selecione uma forma de pagamento!", "error");
                return;
            }
            
            // Verificar se há itens no pedido
            if (currentOrder.length === 0) {
                showNotification("Adicione itens ao pedido antes de registrar!", "error");
                return;
            }
            
            // CORREÇÃO: Salvar pedido atual antes de limpar
            const pedidoParaImpressao = [...currentOrder];
            
            currentSale = {
                id: orderCounter++,
                date: new Date().toISOString(),
                items: [...currentOrder],
                subtotal: currentOrder.reduce((sum, item) => sum + item.price, 0),
                total: currentOrder.reduce((sum, item) => sum + item.price, 0),
                paymentMethod: selectedPaymentMethod,
                deliveryCount: 0,
                deliveryFee: 0,
                deliveryTotal: 0,
                deliveryDriver: ""
            };
            
            // Limpar pedido atual
            currentOrder = [];
            selectedPaymentMethod = null;
            renderOrderItems();
            updateOrderSummary();
            closePaymentModal();
            
            // CORREÇÃO: Salvar pedido para impressão
            pendingPrintOrder = pedidoParaImpressao;
            
            // Mostrar modal para perguntar se é delivery
            showDeliveryConfirmationModal();
        }

        // Finalizar venda sem delivery
        function finishSaleWithoutDelivery() {
            if (!currentSale) return;
            
            // Salvar venda sem delivery
            const sales = JSON.parse(localStorage.getItem('açaiteria_sales') || '[]');
            sales.push(currentSale);
            localStorage.setItem('açaiteria_sales', JSON.stringify(sales));
            
            // Registrar também no histórico de vendas do dia
            const todaySales = JSON.parse(localStorage.getItem('today_sales') || '[]');
            todaySales.push(currentSale);
            localStorage.setItem('today_sales', JSON.stringify(todaySales));
            
            showNotification(`Venda #${currentSale.id} registrada com sucesso! Pagamento: ${paymentMethods[currentSale.paymentMethod]?.name || 'N/A'}`);
            
            // Atualizar informações do dia
            updateDayInfo();
            
            // Atualizar relatório se estiver na tela de relatórios
            if (document.getElementById('reports-container').classList.contains('active')) {
                loadSalesReport();
            }
            
            // CORREÇÃO: Mostrar modal de confirmação de impressão para ambos os casos
            showPrintConfirmationModal();
            
            currentSale = null;
            closeDeliveryConfirmationModal();
        }

        // Iniciar fluxo de delivery
        function startDeliveryFlow() {
            if (!currentSale) return;
            
            isDeliveryFlow = true;
            
            // Mostrar seção de delivery
            document.getElementById('delivery-section').classList.add('active');
            
            // Resetar contador de delivery para esta venda
            deliveryCount = 0;
            deliveryTotalValue = 0;
            updateDeliveryDisplay();
            
            closeDeliveryConfirmationModal();
        }

        // Finalizar delivery e salvar venda
        function finishDeliveryAndSaveSale() {
            if (!currentSale) return;
            
            // Atualizar venda com informações de delivery
            currentSale.deliveryCount = deliveryCount;
            currentSale.deliveryFee = deliveryFee;
            currentSale.deliveryTotal = deliveryTotalValue;
            currentSale.deliveryDriver = deliveryDriverName;
            
            // Salvar venda
            const sales = JSON.parse(localStorage.getItem('açaiteria_sales') || '[]');
            sales.push(currentSale);
            localStorage.setItem('açaiteria_sales', JSON.stringify(sales));
            
            // Registrar também no histórico de vendas do dia
            const todaySales = JSON.parse(localStorage.getItem('today_sales') || '[]');
            todaySales.push(currentSale);
            localStorage.setItem('today_sales', JSON.stringify(todaySales));
            
            // Registrar entregas no histórico
            if (deliveryCount > 0) {
                const deliveryRecord = {
                    id: Date.now(),
                    date: new Date().toISOString(),
                    type: deliveryFee === STANDARD_DELIVERY_FEE ? "standard" : "custom",
                    fee: deliveryFee,
                    count: deliveryCount,
                    total: deliveryTotalValue,
                    driver: deliveryDriverName,
                    saleId: currentSale.id
                };
                
                const deliveries = JSON.parse(localStorage.getItem('deliveries') || '[]');
                deliveries.push(deliveryRecord);
                localStorage.setItem('deliveries', JSON.stringify(deliveries));
            }
            
            showNotification(`Venda #${currentSale.id} com ${deliveryCount} entrega(s) registrada com sucesso!`);
            
            // Resetar delivery
            deliveryCount = 0;
            deliveryTotalValue = 0;
            deliveryFee = STANDARD_DELIVERY_FEE;
            updateDeliveryDisplay();
            
            // Esconder seção de delivery
            document.getElementById('delivery-section').classList.remove('active');
            isDeliveryFlow = false;
            
            // Atualizar informações do dia
            updateDayInfo();
            
            // Atualizar relatório se estiver na tela de relatórios
            if (document.getElementById('reports-container').classList.contains('active')) {
                loadSalesReport();
            }
            
            // CORREÇÃO: Mostrar modal de confirmação de impressão para ambos os casos
            showPrintConfirmationModal();
            
            currentSale = null;
        }

        // Pular delivery (salvar venda sem delivery)
        function skipDelivery() {
            if (!currentSale) return;
            
            // Esconder seção de delivery
            document.getElementById('delivery-section').classList.remove('active');
            isDeliveryFlow = false;
            
            // Resetar delivery
            deliveryCount = 0;
            deliveryTotalValue = 0;
            updateDeliveryDisplay();
            
            // Salvar venda sem delivery
            finishSaleWithoutDelivery();
        }

        // Cancelar venda registrada
        function cancelSale(saleId) {
            currentSaleToCancel = saleId;
            currentModalAction = 'cancel_sale';
            document.getElementById('password-modal-message').textContent = 
                "Para cancelar esta venda, digite a senha de administrador:";
            showPasswordModal();
        }

        // Executar cancelamento de venda após validação
        function executeSaleCancellation() {
            const sales = JSON.parse(localStorage.getItem('açaiteria_sales') || '[]');
            const updatedSales = sales.filter(sale => sale.id !== currentSaleToCancel);
            localStorage.setItem('açaiteria_sales', JSON.stringify(updatedSales));
            
            // Remover também do histórico do dia se existir
            const todaySales = JSON.parse(localStorage.getItem('today_sales') || '[]');
            const updatedTodaySales = todaySales.filter(sale => sale.id !== currentSaleToCancel);
            localStorage.setItem('today_sales', JSON.stringify(updatedTodaySales));
            
            // Remover deliveries associados a esta venda
            const deliveries = JSON.parse(localStorage.getItem('deliveries') || '[]');
            const updatedDeliveries = deliveries.filter(d => d.saleId !== currentSaleToCancel);
            localStorage.setItem('deliveries', JSON.stringify(updatedDeliveries));
            
            showNotification(`Venda #${currentSaleToCancel} cancelada com sucesso!`, "warning");
            loadSalesReport();
            updateDayInfo();
            currentSaleToCancel = null;
        }

        // Limpar pedido atual
        function clearOrder() {
            if (currentOrder.length === 0 && deliveryCount === 0) {
                showNotification("Não há nada para limpar!", "info");
                return;
            }
            
            if (confirm("Tem certeza que deseja limpar o pedido atual?")) {
                currentOrder = [];
                renderOrderItems();
                updateOrderSummary();
                showNotification("Pedido limpo com sucesso!");
            }
        }

        // Cancelar ação
        function cancelOrder() {
            if (currentOrder.length === 0 && deliveryCount === 0) {
                showNotification("Não há pedido para cancelar!", "info");
                return;
            }
            
            if (confirm("Deseja cancelar o pedido atual?")) {
                currentOrder = [];
                renderOrderItems();
                updateOrderSummary();
                showNotification("Pedido cancelado!");
            }
        }

        // Adicionar despesa do dia (PDV)
        function addDailyExpense() {
            const valueInput = document.getElementById('expense-value-input');
            const descriptionInput = document.getElementById('expense-description');
            
            const value = parseFloat(valueInput.value);
            const description = descriptionInput.value.trim() || "Despesa do dia";
            
            if (isNaN(value) || value <= 0) {
                showNotification("Digite um valor válido!", "error");
                return;
            }
            
            const expense = {
                id: Date.now(),
                date: new Date().toISOString(),
                description: description,
                value: value,
                type: "daily"
            };
            
            dailyExpenses.push(expense);
            renderDailyExpenses();
            
            // Salvar no localStorage
            const expenses = JSON.parse(localStorage.getItem('daily_expenses') || '[]');
            expenses.push(expense);
            localStorage.setItem('daily_expenses', JSON.stringify(expenses));
            
            valueInput.value = '';
            descriptionInput.value = '';
            
            showNotification("Despesa do dia registrada!");
            updateDayInfo();
        }

        // Remover despesa do dia
        function removeDailyExpense(expenseId) {
            const expenseIndex = dailyExpenses.findIndex(exp => exp.id === expenseId);
            if (expenseIndex !== -1) {
                dailyExpenses.splice(expenseIndex, 1);
                renderDailyExpenses();
                
                // Atualizar localStorage
                localStorage.setItem('daily_expenses', JSON.stringify(dailyExpenses));
                
                showNotification("Despesa removida!");
                updateDayInfo();
            }
        }

        // Renderizar despesas do dia
        function renderDailyExpenses() {
            const expensesContainer = document.getElementById('expenses-container');
            const emptyExpenseMessage = document.getElementById('empty-expense-message');
            
            // Limpar container
            const expensesToRemove = expensesContainer.querySelectorAll('.expense-item');
            expensesToRemove.forEach(item => item.remove());
            
            if (dailyExpenses.length === 0) {
                emptyExpenseMessage.style.display = 'block';
                return;
            }
            
            emptyExpenseMessage.style.display = 'none';
            
            // Adicionar despesas
            dailyExpenses.forEach(expense => {
                const expenseElement = document.createElement('div');
                expenseElement.className = 'expense-item';
                expenseElement.innerHTML = `
                    <span class="expense-name">${expense.description}</span>
                    <span class="expense-value">${formatCurrency(expense.value)}</span>
                    <button class="expense-remove" data-id="${expense.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                
                expensesContainer.appendChild(expenseElement);
            });
            
            // Adicionar event listeners aos botões de remover
            document.querySelectorAll('.expense-remove').forEach(button => {
                button.addEventListener('click', function() {
                    const expenseId = parseInt(this.getAttribute('data-id'));
                    removeDailyExpense(expenseId);
                });
            });
        }

        // Exportar relatório completo
        function exportCompleteReport(format) {
            const sales = getFilteredSales();
            const dailyExpensesData = JSON.parse(localStorage.getItem('daily_expenses') || '[]');
            const deliveries = JSON.parse(localStorage.getItem('deliveries') || '[]');
            
            if (sales.length === 0 && dailyExpensesData.length === 0 && deliveries.length === 0) {
                showNotification("Não há dados para exportar!", "warning");
                return;
            }
            
            if (format === 'csv') {
                exportCompleteToCSV(sales, dailyExpensesData, deliveries);
            } else {
                exportCompleteToTXT(sales, dailyExpensesData, deliveries);
            }
        }

        // Exportar para CSV completo
        function exportCompleteToCSV(sales, dailyExpenses, deliveries) {
            let csvContent = "RELATÓRIO COMPLETO - QUERO MAIS AÇAÍ\n\n";
            
            // Seção de Vendas
            csvContent += "VENDAS\n";
            csvContent += "ID Venda;Data;Hora;Itens;Sabor;Tamanho;Quantidade;Valor Unitário;Valor Total;Subtotal;Total;Forma de Pagamento;Delivery Incluído;Taxa Delivery;Entregador\n";
            
            sales.forEach(sale => {
                const date = new Date(sale.date);
                const dateStr = date.toLocaleDateString('pt-BR');
                const timeStr = date.toLocaleTimeString('pt-BR');
                const hasDelivery = sale.deliveryCount > 0 ? "Sim" : "Não";
                const deliveryFee = sale.deliveryFee || 0;
                const driverName = sale.deliveryDriver || "Não informado";
                
                sale.items.forEach(item => {
                    const flavor = item.flavor || "Não especificado";
                    const size = item.size || "Não especificado";
                    csvContent += `${sale.id};${dateStr};${timeStr};"${item.name}";"${flavor}";${size};1;${item.price.toFixed(2).replace('.', ',')};${item.price.toFixed(2).replace('.', ',')};${sale.subtotal.toFixed(2).replace('.', ',')};${sale.total.toFixed(2).replace('.', ',')};${paymentMethods[sale.paymentMethod]?.name || 'N/A'};${hasDelivery};${deliveryFee.toFixed(2).replace('.', ',')};"${driverName}"\n`;
                });
                
                // Linha resumo da venda
                csvContent += `${sale.id};${dateStr};${timeStr};"RESUMO DA VENDA";;;${sale.items.length};;;${sale.subtotal.toFixed(2).replace('.', ',')};${sale.total.toFixed(2).replace('.', ',')};${paymentMethods[sale.paymentMethod]?.name || 'N/A'};${hasDelivery};${deliveryFee.toFixed(2).replace('.', ',')};"${driverName}"\n`;
            });
            
            // Seção de Delivery
            csvContent += "\n\nDELIVERY\n";
            csvContent += "ID;Data;Hora;Quantidade Entregas;Taxa Unitária;Valor Total;Entregador;ID Venda\n";
            
            deliveries.forEach(delivery => {
                const date = new Date(delivery.date);
                csvContent += `${delivery.id};${date.toLocaleDateString('pt-BR')};${date.toLocaleTimeString('pt-BR')};${delivery.count};${delivery.fee.toFixed(2).replace('.', ',')};${delivery.total.toFixed(2).replace('.', ',')};"${delivery.driver || 'Não informado'}";${delivery.saleId || ''}\n`;
            });
            
            // Seção de Despesas do Dia
            csvContent += "\n\nDESPESAS DO DIA\n";
            csvContent += "ID;Data;Hora;Descrição;Valor\n";
            
            dailyExpenses.forEach(expense => {
                const date = new Date(expense.date);
                csvContent += `${expense.id};${date.toLocaleDateString('pt-BR')};${date.toLocaleTimeString('pt-BR')};"${expense.description}";${expense.value.toFixed(2).replace('.', ',')}\n`;
            });
            
            // Resumo Geral
            const totalSales = sales.reduce((sum, sale) => sum + sale.total, 0);
            const totalDailyExpensesSum = dailyExpenses.reduce((sum, expense) => sum + expense.value, 0);
            const totalDeliveryFees = deliveries.reduce((sum, delivery) => sum + delivery.total, 0);
            const totalDeliveries = deliveries.reduce((sum, delivery) => sum + delivery.count, 0);
            const totalRevenueNoDelivery = totalSales;
            const totalRevenueWithDelivery = totalSales + totalDeliveryFees;
            const totalExpenses = totalDailyExpensesSum;
            const profitNoDelivery = totalRevenueNoDelivery - totalExpenses;
            const profitWithDelivery = totalRevenueWithDelivery - totalExpenses;
            
            // Análise de formas de pagamento
            const paymentAnalysis = {};
            sales.forEach(sale => {
                const method = sale.paymentMethod || 'unknown';
                paymentAnalysis[method] = (paymentAnalysis[method] || 0) + 1;
            });
            let mostUsedPayment = "N/A";
            let maxCount = 0;
            for (const [method, count] of Object.entries(paymentAnalysis)) {
                if (count > maxCount) {
                    maxCount = count;
                    mostUsedPayment = paymentMethods[method]?.name || method;
                }
            }
            
            csvContent += "\n\nRESUMO GERAL\n";
            csvContent += `Total de Vendas;${sales.length}\n`;
            csvContent += `Valor Total Vendido (sem delivery);${totalRevenueNoDelivery.toFixed(2).replace('.', ',')}\n`;
            csvContent += `Total em Taxas de Delivery;${totalDeliveryFees.toFixed(2).replace('.', ',')}\n`;
            csvContent += `Receita Total (com delivery);${totalRevenueWithDelivery.toFixed(2).replace('.', ',')}\n`;
            csvContent += `Total de Entregas;${totalDeliveries}\n`;
            csvContent += `Total de Despesas;${totalExpenses.toFixed(2).replace('.', ',')}\n`;
            csvContent += `Forma de Pagamento Mais Usada;${mostUsedPayment}\n`;
            csvContent += `Lucro Líquido (sem delivery);${profitNoDelivery.toFixed(2).replace('.', ',')}\n`;
            csvContent += `Lucro Líquido (com delivery);${profitWithDelivery.toFixed(2).replace('.', ',')}\n`;
            csvContent += `Data do Relatório;${new Date().toLocaleDateString('pt-BR')}\n`;
            
            const filename = currentMonthFilter 
                ? `relatorio_completo_${MONTH_NAMES[currentMonthFilter.month]}_${currentMonthFilter.year}.csv`
                : 'relatorio_completo.csv';
            
            downloadFile(csvContent, filename, 'text/csv');
            showNotification("Relatório CSV completo exportado com sucesso!");
        }

        // Exportar para TXT completo
        function exportCompleteToTXT(sales, dailyExpenses, deliveries) {
            let txtContent = "=".repeat(70) + "\n";
            txtContent += "RELATÓRIO COMPLETO - QUERO MAIS AÇAÍ\n";
            
            if (currentMonthFilter) {
                txtContent += `MÊS: ${MONTH_NAMES[currentMonthFilter.month]}/${currentMonthFilter.year}\n`;
            }
            
            txtContent += "=".repeat(70) + "\n\n";
            
            // Seção de Vendas
            txtContent += "VENDAS\n";
            txtContent += "=".repeat(70) + "\n\n";
            
            if (sales.length === 0) {
                txtContent += "Nenhuma venda registrada neste período.\n\n";
            } else {
                sales.forEach(sale => {
                    const date = new Date(sale.date);
                    const hasDelivery = sale.deliveryCount > 0;
                    const deliveryInfo = hasDelivery ? 
                        ` (Com delivery: ${sale.deliveryCount} entrega(s) - R$ ${(sale.deliveryFee || 0).toFixed(2)} - Entregador: ${sale.deliveryDriver || 'Não informado'})` : 
                        "";
                    
                    txtContent += `Venda #${sale.id} - ${date.toLocaleDateString('pt-BR')} ${date.toLocaleTimeString('pt-BR')}\n`;
                    txtContent += `Forma de Pagamento: ${paymentMethods[sale.paymentMethod]?.name || 'N/A'}${deliveryInfo}\n`;
                    txtContent += "-".repeat(50) + "\n";
                    
                    sale.items.forEach(item => {
                        const flavorInfo = item.flavor ? ` [${item.flavor}]` : '';
                        txtContent += `• ${item.name}${flavorInfo.padEnd(35)} ${formatCurrency(item.price).padStart(15)}\n`;
                        if (item.details && item.details.includes('Sabor:')) {
                            txtContent += `  ${item.details}\n`;
                        }
                    });
                    
                    txtContent += "\n";
                    txtContent += `Subtotal:${"".padEnd(43)} ${formatCurrency(sale.subtotal).padStart(15)}\n`;
                    if (hasDelivery) {
                        txtContent += `Taxa Delivery:${"".padEnd(37)} ${formatCurrency(sale.deliveryFee || 0).padStart(15)}\n`;
                    }
                    txtContent += `Total:${"".padEnd(45)} ${formatCurrency(sale.total).padStart(15)}\n\n`;
                });
            }
            
            // Seção de Delivery
            txtContent += "DELIVERY (ENTREGAS)\n";
            txtContent += "=".repeat(70) + "\n\n";
            
            if (deliveries.length === 0) {
                txtContent += "Nenhuma entrega registrada neste período.\n\n";
            } else {
                const totalDeliveries = deliveries.reduce((sum, delivery) => sum + delivery.count, 0);
                const totalDeliveryFees = deliveries.reduce((sum, delivery) => sum + delivery.total, 0);
                
                txtContent += `Resumo: ${totalDeliveries} entrega(s) realizadas\n`;
                txtContent += `Total em delivery: ${formatCurrency(totalDeliveryFees)}\n\n`;
                
                deliveries.forEach(delivery => {
                    const date = new Date(delivery.date);
                    txtContent += `• ${date.toLocaleDateString('pt-BR')} ${date.toLocaleTimeString('pt-BR').padEnd(15)} ${delivery.count.toString().padStart(3)} entrega(s) ${formatCurrency(delivery.total).padStart(15)} ${delivery.driver ? `- ${delivery.driver}` : ''}${delivery.saleId ? ` (Venda #${delivery.saleId})` : ''}\n`;
                });
                txtContent += "\n";
            }
            
            // Seção de Despesas do Dia
            txtContent += "DESPESAS DO DIA\n";
            txtContent += "=".repeat(70) + "\n\n";
            
            if (dailyExpenses.length === 0) {
                txtContent += "Nenhuma despesa do dia registrada.\n\n";
            } else {
                dailyExpenses.forEach(expense => {
                    const date = new Date(expense.date);
                    txtContent += `• ${date.toLocaleDateString('pt-BR')} ${date.toLocaleTimeString('pt-BR')} - ${expense.description.padEnd(40)} ${formatCurrency(expense.value).padStart(15)}\n`;
                });
                txtContent += "\n";
            }
            
            // Resumo Geral
            const totalSales = sales.reduce((sum, sale) => sum + sale.total, 0);
            const totalDailyExpensesSum = dailyExpenses.reduce((sum, expense) => sum + expense.value, 0);
            const totalDeliveryFees = deliveries.reduce((sum, delivery) => sum + delivery.total, 0);
            const totalDeliveries = deliveries.reduce((sum, delivery) => sum + delivery.count, 0);
            const totalRevenueNoDelivery = totalSales;
            const totalRevenueWithDelivery = totalSales + totalDeliveryFees;
            const totalExpenses = totalDailyExpensesSum;
            const profitNoDelivery = totalRevenueNoDelivery - totalExpenses;
            const profitWithDelivery = totalRevenueWithDelivery - totalExpenses;
            const avgTicket = sales.length > 0 ? totalSales / sales.length : 0;
            
            // Análise de formas de pagamento
            const paymentAnalysis = {};
            sales.forEach(sale => {
                const method = sale.paymentMethod || 'unknown';
                paymentAnalysis[method] = (paymentAnalysis[method] || 0) + 1;
            });
            let mostUsedPayment = "N/A";
            let maxCount = 0;
            for (const [method, count] of Object.entries(paymentAnalysis)) {
                if (count > maxCount) {
                    maxCount = count;
                    mostUsedPayment = paymentMethods[method]?.name || method;
                }
            }
            
            txtContent += "RESUMO GERAL\n";
            txtContent += "=".repeat(70) + "\n";
            txtContent += `Total de Vendas: ${sales.length}\n`;
            txtContent += `Valor Total Vendido: ${formatCurrency(totalSales)}\n`;
            txtContent += `Ticket Médio: ${formatCurrency(avgTicket)}\n`;
            txtContent += `Total de Entregas: ${totalDeliveries}\n`;
            txtContent += `Total em Taxas de Delivery: ${formatCurrency(totalDeliveryFees)}\n`;
            txtContent += `Receita Total (sem delivery): ${formatCurrency(totalRevenueNoDelivery)}\n`;
            txtContent += `Receita Total (com delivery): ${formatCurrency(totalRevenueWithDelivery)}\n`;
            txtContent += `Total de Despesas: ${formatCurrency(totalExpenses)}\n`;
            txtContent += `Forma de Pagamento Mais Usada: ${mostUsedPayment}\n`;
            txtContent += `Lucro Líquido (sem delivery): ${formatCurrency(profitNoDelivery)}\n`;
            txtContent += `Lucro Líquido (com delivery): ${formatCurrency(profitWithDelivery)}\n`;
            txtContent += `Data do Relatório: ${new Date().toLocaleDateString('pt-BR')} ${new Date().toLocaleTimeString('pt-BR')}\n`;
            txtContent += "=".repeat(70) + "\n";
            
            const filename = currentMonthFilter 
                ? `relatorio_completo_${MONTH_NAMES[currentMonthFilter.month]}_${currentMonthFilter.year}.txt`
                : 'relatorio_completo.txt';
            
            downloadFile(txtContent, filename, 'text/plain');
            showNotification("Relatório TXT completo exportado com sucesso!");
        }

        // Função para baixar arquivo
        function downloadFile(content, filename, mimeType) {
            const blob = new Blob(["\ufeff" + content], { type: mimeType + ';charset=utf-8;' });
            const link = document.createElement('a');
            
            if (navigator.msSaveBlob) {
                navigator.msSaveBlob(blob, filename);
            } else {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        // Mostrar modal de senha
        function showPasswordModal() {
            document.getElementById('password-modal').classList.add('active');
            document.getElementById('admin-password').focus();
        }

        // Fechar modal de senha
        function closePasswordModal() {
            document.getElementById('password-modal').classList.remove('active');
            document.getElementById('admin-password').value = '';
            currentModalAction = null;
            currentSaleToCancel = null;
        }

        // Limpar histórico de vendas
        function clearAllSales() {
            const sales = JSON.parse(localStorage.getItem('açaiteria_sales') || '[]');
            
            if (sales.length === 0) {
                showNotification("Não há vendas para limpar!", "info");
                return;
            }
            
            currentModalAction = 'clear_all';
            document.getElementById('password-modal-message').textContent = 
                "Para limpar o histórico de vendas, digite a senha de administrador:";
            showPasswordModal();
        }

        // Validar senha e executar ação
        function validateAndExecute() {
            const password = document.getElementById('admin-password').value;
            
            if (password === ADMIN_PASSWORD) {
                if (currentModalAction === 'clear_all') {
                    // Limpar todos os dados
                    localStorage.removeItem('açaiteria_sales');
                    localStorage.removeItem('daily_expenses');
                    localStorage.removeItem('today_sales');
                    localStorage.removeItem('deliveries');
                    localStorage.removeItem('delivery_count');
                    localStorage.removeItem('delivery_total');
                    localStorage.removeItem('delivery_fee');
                    localStorage.removeItem('delivery_driver');
                    localStorage.removeItem(LAST_RESET_KEY);
                    
                    orderCounter = 1;
                    currentMonthFilter = null;
                    currentOrder = [];
                    dailyExpenses = [];
                    deliveryCount = 0;
                    deliveryTotalValue = 0;
                    deliveryFee = STANDARD_DELIVERY_FEE;
                    deliveryDriverName = "";
                    
                    showNotification("Todos os dados foram apagados com sucesso!", "warning");
                    
                    // Atualizar todas as telas
                    if (document.getElementById('pdv-container').classList.contains('active')) {
                        renderOrderItems();
                        updateOrderSummary();
                        renderDailyExpenses();
                        updateDeliveryDisplay();
                        updatePrintedOrder();
                        updateDayInfo();
                    }
                    if (document.getElementById('reports-container').classList.contains('active')) {
                        loadSalesReport();
                    }
                    
                } else if (currentModalAction === 'cancel_sale') {
                    executeSaleCancellation();
                }
                
                closePasswordModal();
            } else {
                showNotification("Senha incorreta!", "error");
                document.getElementById('admin-password').value = '';
                document.getElementById('admin-password').focus();
            }
        }

        // Obter vendas filtradas (por mês ou todas)
        function getFilteredSales() {
            const sales = JSON.parse(localStorage.getItem('açaiteria_sales') || '[]');
            
            if (!currentMonthFilter) {
                return sales;
            }
            
            return sales.filter(sale => {
                const saleDate = new Date(sale.date);
                return saleDate.getMonth() === currentMonthFilter.month && 
                       saleDate.getFullYear() === currentMonthFilter.year;
            });
        }

        // Carregar relatório de vendas
        function loadSalesReport() {
            const sales = getFilteredSales();
            const dailyExpensesData = JSON.parse(localStorage.getItem('daily_expenses') || '[]');
            const deliveries = JSON.parse(localStorage.getItem('deliveries') || '[]');
            
            const tableBody = document.getElementById('sales-table-body');
            const noSalesMessage = document.getElementById('no-sales-message');
            
            tableBody.innerHTML = '';
            
            if (sales.length === 0) {
                noSalesMessage.style.display = 'block';
                updateReportStats(sales, dailyExpensesData, deliveries);
                return;
            }
            
            noSalesMessage.style.display = 'none';
            
            // Ordenar vendas por data (mais recente primeiro)
            sales.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Adicionar vendas à tabela
            sales.forEach(sale => {
                const date = new Date(sale.date);
                const row = document.createElement('tr');
                
                // Resumo dos itens
                let itemsSummary = sale.items.map(item => {
                    return item.flavor ? `${item.name} [${item.flavor}]` : item.name;
                }).join(', ');
                
                if (itemsSummary.length > 40) {
                    itemsSummary = itemsSummary.substring(0, 37) + '...';
                }
                
                const paymentMethod = paymentMethods[sale.paymentMethod] || { name: 'N/A', color: '#666' };
                const hasDelivery = sale.deliveryCount > 0;
                const deliveryInfo = hasDelivery 
                    ? `<span style="color: var(--delivery-color);">
                          <i class="fas fa-motorcycle"></i> ${sale.deliveryCount} entrega(s)<br>
                          <small>${sale.deliveryDriver ? `Entregador: ${sale.deliveryDriver}` : ''}</small>
                       </span>`
                    : '<span style="color: #999;">Sem delivery</span>';
                
                row.innerHTML = `
                    <td>${sale.id}</td>
                    <td>${formatDate(sale.date)}</td>
                    <td>${itemsSummary} (${sale.items.length} itens)</td>
                    <td>${formatCurrency(sale.total)}</td>
                    <td>
                        <span style="color: ${paymentMethod.color}; font-weight: 600;">
                            <i class="fas ${paymentMethod.icon}"></i> ${paymentMethod.name}
                        </span>
                    </td>
                    <td>${deliveryInfo}</td>
                    <td>
                        <button class="cancel-sale-btn" data-id="${sale.id}">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Adicionar event listeners aos botões de cancelar
            document.querySelectorAll('.cancel-sale-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const saleId = parseInt(this.getAttribute('data-id'));
                    cancelSale(saleId);
                });
            });
            
            updateReportStats(sales, dailyExpensesData, deliveries);
        }

        // Atualizar estatísticas do relatório
        function updateReportStats(sales, dailyExpenses, deliveries) {
            const totalSales = sales.length;
            const totalSalesAmount = sales.reduce((sum, sale) => sum + sale.total, 0);
            
            // Calcular estatísticas de delivery
            let totalDeliveryFees = 0;
            let totalDeliveriesCount = 0;
            if (currentMonthFilter) {
                totalDeliveryFees = deliveries
                    .filter(delivery => {
                        const deliveryDate = new Date(delivery.date);
                        return deliveryDate.getMonth() === currentMonthFilter.month && 
                               deliveryDate.getFullYear() === currentMonthFilter.year;
                    })
                    .reduce((sum, delivery) => sum + delivery.total, 0);
                totalDeliveriesCount = deliveries
                    .filter(delivery => {
                        const deliveryDate = new Date(delivery.date);
                        return deliveryDate.getMonth() === currentMonthFilter.month && 
                               deliveryDate.getFullYear() === currentMonthFilter.year;
                    })
                    .reduce((sum, delivery) => sum + delivery.count, 0);
            } else {
                totalDeliveryFees = deliveries.reduce((sum, delivery) => sum + delivery.total, 0);
                totalDeliveriesCount = deliveries.reduce((sum, delivery) => sum + delivery.count, 0);
            }
            
            // Calcular estatísticas de despesas
            let totalDailyExpenses = 0;
            if (currentMonthFilter) {
                totalDailyExpenses = dailyExpenses
                    .filter(expense => {
                        const expenseDate = new Date(expense.date);
                        return expenseDate.getMonth() === currentMonthFilter.month && 
                               expenseDate.getFullYear() === currentMonthFilter.year;
                    })
                    .reduce((sum, expense) => sum + expense.value, 0);
            } else {
                totalDailyExpenses = dailyExpenses.reduce((sum, expense) => sum + expense.value, 0);
            }
            
            const totalExpensesAmount = totalDailyExpenses;
            const totalRevenueNoDelivery = totalSalesAmount;
            const totalRevenueWithDelivery = totalSalesAmount + totalDeliveryFees;
            const profitNoDelivery = totalRevenueNoDelivery - totalExpensesAmount;
            const profitWithDelivery = totalRevenueWithDelivery - totalExpensesAmount;
            
            // Análise de formas de pagamento
            const paymentAnalysis = {};
            sales.forEach(sale => {
                const method = sale.paymentMethod || 'unknown';
                paymentAnalysis[method] = (paymentAnalysis[method] || 0) + 1;
            });
            
            let mostUsedPayment = "N/A";
            let maxCount = 0;
            for (const [method, count] of Object.entries(paymentAnalysis)) {
                if (count > maxCount) {
                    maxCount = count;
                    mostUsedPayment = paymentMethods[method]?.name || method;
                }
            }
            
            // Atualizar estatísticas
            document.getElementById('total-sales-count').textContent = totalSales;
            document.getElementById('total-sales-amount').textContent = formatCurrency(totalSalesAmount);
            document.getElementById('total-delivery-amount').textContent = formatCurrency(totalDeliveryFees);
            document.getElementById('total-expenses-amount').textContent = formatCurrency(totalExpensesAmount);
            
            document.getElementById('total-revenue-no-delivery').textContent = formatCurrency(totalRevenueNoDelivery);
            document.getElementById('total-revenue-with-delivery').textContent = formatCurrency(totalRevenueWithDelivery);
            document.getElementById('total-expenses').textContent = formatCurrency(totalExpensesAmount);
            document.getElementById('most-used-payment').textContent = mostUsedPayment;
            document.getElementById('total-deliveries').textContent = totalDeliveriesCount;
            
            document.getElementById('total-profit-no-delivery').textContent = formatCurrency(profitNoDelivery);
            document.getElementById('total-profit-with-delivery').textContent = formatCurrency(profitWithDelivery);
            
            // Aplicar cores aos lucros
            document.getElementById('total-profit-no-delivery').className = profitNoDelivery >= 0 ? 'financial-total positive' : 'financial-total negative';
            document.getElementById('total-profit-with-delivery').className = profitWithDelivery >= 0 ? 'financial-total positive' : 'financial-total negative';
        }

        // Mostrar notificação
        function showNotification(message, type = "success") {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notification-text');
            
            if (type === "error") {
                notification.style.backgroundColor = "var(--danger-color)";
                notification.querySelector('i').className = "fas fa-exclamation-circle";
            } else if (type === "info") {
                notification.style.backgroundColor = "var(--info-color)";
                notification.querySelector('i').className = "fas fa-info-circle";
            } else if (type === "warning") {
                notification.style.backgroundColor = "var(--warning-color)";
                notification.querySelector('i').className = "fas fa-exclamation-triangle";
            } else {
                notification.style.backgroundColor = "var(--success-color)";
                notification.querySelector('i').className = "fas fa-check-circle";
            }
            
            notificationText.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Imprimir pedido (NOVO - função separada para reutilização)
        function printOrder() {
            // CORREÇÃO: Usar pedido pendente se existir, senão usar pedido atual
            const pedidoParaImprimir = pendingPrintOrder || currentOrder;
            
            if (pedidoParaImprimir.length === 0) {
                showNotification("Adicione itens ao pedido antes de imprimir!", "warning");
                return;
            }
            
            // Criar conteúdo para impressão
            let printContent = `
                <div style="font-family: 'Courier New', monospace; font-size: 12px; width: 58mm;">
                    <div style="text-align: center; font-weight: bold; margin-bottom: 10px;">
                        QUERO MAIS AÇAÍ<br>
                        PEDIDO PARA COZINHA<br>
                        ${new Date().toLocaleDateString('pt-BR')} ${new Date().toLocaleTimeString('pt-BR').substring(0, 5)}<br>
                        --------------------
                    </div>
            `;
            
            pedidoParaImprimir.forEach(item => {
                printContent += `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>${item.name}</span>
                        <span>${formatCurrency(item.price)}</span>
                    </div>
                `;
                
                // Adicionar detalhes do sabor se for açaí
                if (item.details) {
                    printContent += `
                        <div style="font-size: 10px; color: #666; margin-left: 10px; margin-bottom: 5px;">
                            ${item.details}
                        </div>
                    `;
                }
            });
            
            const subtotal = pedidoParaImprimir.reduce((sum, item) => sum + item.price, 0);
            printContent += `
                    <div style="border-top: 1px dashed #000; margin-top: 10px; padding-top: 10px;">
                        <div style="text-align: center; font-weight: bold;">
                            TOTAL: ${formatCurrency(subtotal)}<br>
                            --------------------<br>
                            🍓🍌🥝 AÇAÍ SABOROSO! 🥭🍯🍓
                        </div>
                    </div>
                </div>
            `;
            
            // Criar janela de impressão
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Pedido para Cozinha</title>
                        <style>
                            @media print {
                                body { margin: 0; padding: 0; }
                            }
                        </style>
                    </head>
                    <body onload="window.print(); window.close();">
                        ${printContent}
                    </body>
                </html>
            `);
            printWindow.document.close();
            
            // CORREÇÃO: Limpar pedido pendente após imprimir
            pendingPrintOrder = null;
            
            showNotification("Pedido impresso para a cozinha!");
        }

        // Função para confirmar impressão após venda
        function confirmPrintAfterSale() {
            printOrder();
            closePrintConfirmationModal();
        }

        // Inicializar produtos na interface
        function initializeProducts() {
            const acaiProductsContainer = document.getElementById('acai-products');
            const adicionaisContainer = document.getElementById('adicionais');
            const bebidasContainer = document.getElementById('bebidas');
            const flavorsGrid = document.getElementById('flavors-grid');
            
            // Produtos de açaí
            products.acai.forEach(product => {
                const productElement = document.createElement('div');
                productElement.className = 'product-card';
                productElement.innerHTML = `
                    <div class="product-icon">
                        <i class="fas ${product.icon}"></i>
                    </div>
                    <div class="product-name">Açaí ${product.size}</div>
                    <div class="product-size">${product.ml}</div>
                    <div class="product-price">${formatCurrency(product.price)}</div>
                `;
                
                productElement.addEventListener('click', () => showFlavorsModal(product));
                acaiProductsContainer.appendChild(productElement);
            });
            
            // Adicionais
            products.adicionais.forEach(product => {
                const productElement = document.createElement('div');
                productElement.className = 'extra-item';
                productElement.innerHTML = `
                    <div class="extra-name">${product.name}</div>
                    <div class="extra-price">${formatCurrency(product.price)}</div>
                `;
                
                productElement.addEventListener('click', () => addToOrder(product));
                adicionaisContainer.appendChild(productElement);
            });
            
            // Bebidas
            products.bebidas.forEach(product => {
                const productElement = document.createElement('div');
                productElement.className = 'extra-item';
                productElement.innerHTML = `
                    <div class="extra-name">${product.name}</div>
                    <div class="extra-price">${formatCurrency(product.price)}</div>
                `;
                
                productElement.addEventListener('click', () => addToOrder(product));
                bebidasContainer.appendChild(productElement);
            });
            
            // Sabores no modal (SIMPLIFICADO)
            flavors.forEach(flavor => {
                const flavorElement = document.createElement('div');
                flavorElement.className = 'flavor-card';
                flavorElement.dataset.id = flavor.id;
                
                flavorElement.innerHTML = `
                    <div class="flavor-name">${flavor.name}</div>
                `;
                
                flavorElement.addEventListener('click', () => {
                    // Remover seleção anterior
                    document.querySelectorAll('.flavor-card').forEach(card => {
                        card.classList.remove('selected');
                    });
                    
                    // Selecionar este sabor
                    flavorElement.classList.add('selected');
                    selectedFlavor = flavor;
                });
                
                flavorsGrid.appendChild(flavorElement);
            });
        }

        // Popular anos nos seletores
        function populateYearSelects() {
            const yearSelect = document.getElementById('year-select');
            
            yearSelect.innerHTML = '';
            
            const currentYear = new Date().getFullYear();
            
            // Adicionar 5 anos para trás e 1 para frente
            for (let year = currentYear - 5; year <= currentYear + 1; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                if (year === currentYear) {
                    option.selected = true;
                }
                yearSelect.appendChild(option);
            }
        }

        // Alternar entre abas
        function switchTab(tabName) {
            // Atualizar tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // Mostrar container correto
            document.querySelectorAll('.container').forEach(container => {
                container.classList.remove('active');
            });
            
            document.getElementById(`${tabName}-container`).classList.add('active');
            
            // Se for para a aba de relatórios, carregar os dados
            if (tabName === 'reports') {
                loadSalesReport();
                populateYearSelects();
            }
            
            // Se for para a aba PDV, carregar despesas do dia
            if (tabName === 'pdv') {
                loadDailyExpenses();
                loadDeliveryData();
                updateDayInfo();
            }
        }

        // Carregar despesas do dia
        function loadDailyExpenses() {
            const savedExpenses = JSON.parse(localStorage.getItem('daily_expenses') || '[]');
            // Filtrar apenas despesas de hoje
            const today = new Date().toLocaleDateString('pt-BR');
            dailyExpenses = savedExpenses.filter(expense => {
                const expenseDate = new Date(expense.date).toLocaleDateString('pt-BR');
                return expenseDate === today;
            });
            renderDailyExpenses();
        }

        // Carregar dados de delivery
        function loadDeliveryData() {
            const savedCount = localStorage.getItem('delivery_count');
            const savedFee = localStorage.getItem('delivery_fee');
            const savedDriver = localStorage.getItem('delivery_driver');
            
            if (savedCount) {
                deliveryCount = parseInt(savedCount);
            }
            if (savedFee) {
                deliveryFee = parseFloat(savedFee);
            }
            if (savedDriver) {
                deliveryDriverName = savedDriver;
            }
            updateDeliveryDisplay();
        }

        // Limpar pedido impresso
        function clearPrintedOrder() {
            currentOrder = [];
            renderOrderItems();
            updateOrderSummary();
            showNotification("Pedido impresso limpo!");
        }

        // Inicializar event listeners
        function initializeEventListeners() {
            // Botões do PDV - MODIFICADO
            document.getElementById('register-order').addEventListener('click', function() {
                if (currentOrder.length === 0) {
                    showNotification("Adicione itens ao pedido antes de registrar!", "error");
                    return;
                }
                showPaymentModal();
            });
            
            document.getElementById('clear-order').addEventListener('click', clearOrder);
            document.getElementById('cancel-order').addEventListener('click', cancelOrder);
            
            // Botões de Delivery
            document.getElementById('add-delivery-modal-btn').addEventListener('click', showDeliveryModal);
            document.getElementById('add-delivery-quick').addEventListener('click', () => addDelivery());
            document.getElementById('remove-delivery').addEventListener('click', removeDelivery);
            
            // Botão para finalizar delivery
            document.getElementById('finish-delivery').addEventListener('click', finishDeliveryAndSaveSale);
            document.getElementById('skip-delivery').addEventListener('click', skipDelivery);
            
            // Botão para adicionar valor avulso
            document.getElementById('add-custom-value').addEventListener('click', function() {
                const valueInput = document.getElementById('custom-value-input');
                const descriptionInput = document.getElementById('custom-description');
                
                const value = parseFloat(valueInput.value);
                const description = descriptionInput.value.trim() || "Item Avulso";
                
                if (isNaN(value) || value <= 0) {
                    showNotification("Digite um valor válido!", "error");
                    return;
                }
                
                const customProduct = {
                    id: 100 + Date.now(),
                    name: description,
                    price: value
                };
                
                addToOrder(customProduct);
                
                valueInput.value = '';
                descriptionInput.value = '';
            });
            
            // Permitir pressionar Enter para adicionar valor avulso
            document.getElementById('custom-value-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('add-custom-value').click();
                }
            });
            
            document.getElementById('custom-description').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('add-custom-value').click();
                }
            });
            
            // NOVO: Opções de pagamento no modal
            document.querySelectorAll('.payment-option-modal').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.payment-option-modal').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    this.classList.add('selected');
                    selectedPaymentMethod = this.getAttribute('data-method');
                });
            });
            
            // NOVO: Botões de confirmação/cancelamento de pagamento no modal
            document.getElementById('confirm-payment-modal').addEventListener('click', registerOrderWithPayment);
            document.getElementById('cancel-payment-modal').addEventListener('click', function() {
                closePaymentModal();
                showNotification("Pagamento cancelado", "info");
            });
            
            // Botões de despesas do dia
            document.getElementById('add-expense-value').addEventListener('click', addDailyExpense);
            document.getElementById('expense-value-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addDailyExpense();
                }
            });
            
            document.getElementById('expense-description').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addDailyExpense();
                }
            });
            
            // Botões de relatório
            document.getElementById('export-csv').addEventListener('click', () => exportCompleteReport('csv'));
            document.getElementById('export-txt').addEventListener('click', () => exportCompleteReport('txt'));
            document.getElementById('clear-all-sales').addEventListener('click', clearAllSales);
            
            // Botão de relatório mensal
            document.getElementById('export-monthly').addEventListener('click', function() {
                const monthlyFilter = document.getElementById('monthly-filter');
                monthlyFilter.classList.toggle('active');
            });
            
            // Botões do filtro mensal
            document.getElementById('apply-monthly-filter').addEventListener('click', function() {
                const month = parseInt(document.getElementById('month-select').value);
                const year = parseInt(document.getElementById('year-select').value);
                currentMonthFilter = { month, year };
                loadSalesReport();
                showNotification(`Filtro aplicado: ${MONTH_NAMES[month]}/${year}`);
            });
            
            document.getElementById('export-monthly-report').addEventListener('click', () => exportCompleteReport('txt'));
            
            // Modal de delivery
            document.getElementById('standard-delivery').addEventListener('click', function() {
                document.getElementById('standard-delivery').classList.add('selected');
                document.getElementById('custom-delivery').classList.remove('selected');
                document.getElementById('custom-delivery-fields').style.display = 'none';
            });
            
            document.getElementById('custom-delivery').addEventListener('click', function() {
                document.getElementById('standard-delivery').classList.remove('selected');
                document.getElementById('custom-delivery').classList.add('selected');
                document.getElementById('custom-delivery-fields').style.display = 'block';
            });
            
            document.getElementById('confirm-delivery').addEventListener('click', function() {
                const isCustom = document.getElementById('custom-delivery').classList.contains('selected');
                let customFee = null;
                
                if (isCustom) {
                    const customValue = parseFloat(document.getElementById('custom-delivery-value').value);
                    if (isNaN(customValue) || customValue <= 0) {
                        showNotification("Digite um valor válido para a entrega!", "error");
                        return;
                    }
                    customFee = customValue;
                }
                
                addDelivery(customFee, isCustom);
                closeDeliveryModal();
            });
            
            document.getElementById('cancel-delivery').addEventListener('click', closeDeliveryModal);
            
            // Modal de sabores
            document.getElementById('confirm-flavor').addEventListener('click', addAcaiWithFlavor);
            document.getElementById('cancel-flavor').addEventListener('click', closeFlavorsModal);
            
            // Modal do entregador
            document.getElementById('confirm-driver').addEventListener('click', function() {
                const driverName = document.getElementById('driver-name-input').value.trim();
                if (driverName) {
                    deliveryDriverName = driverName;
                    updateDeliveryDisplay();
                    showNotification(`Entregador definido: ${driverName}`);
                } else {
                    showNotification("Nome do entregador não definido", "warning");
                }
                closeDriverModal();
            });
            
            document.getElementById('cancel-driver').addEventListener('click', function() {
                showNotification("Entregador não definido. Pode definir depois.", "info");
                closeDriverModal();
            });
            
            // Modal de confirmação de delivery
            document.getElementById('delivery-yes').addEventListener('click', startDeliveryFlow);
            document.getElementById('delivery-no').addEventListener('click', finishSaleWithoutDelivery);
            document.getElementById('cancel-delivery-confirmation').addEventListener('click', function() {
                closeDeliveryConfirmationModal();
                showNotification("Venda cancelada", "info");
                currentSale = null;
                // CORREÇÃO: Limpar pedido pendente se cancelar
                pendingPrintOrder = null;
            });
            
            // NOVO: Modal de confirmação de impressão
            document.getElementById('confirm-print').addEventListener('click', confirmPrintAfterSale);
            document.getElementById('cancel-print').addEventListener('click', function() {
                closePrintConfirmationModal();
                // CORREÇÃO: Limpar pedido pendente se cancelar impressão
                pendingPrintOrder = null;
                showNotification("Impressão cancelada", "info");
            });
            
            // Modal de senha
            document.getElementById('confirm-password').addEventListener('click', validateAndExecute);
            document.getElementById('cancel-password').addEventListener('click', closePasswordModal);
            
            // Fechar modais com ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    if (document.getElementById('password-modal').classList.contains('active')) {
                        closePasswordModal();
                    }
                    if (document.getElementById('delivery-modal').classList.contains('active')) {
                        closeDeliveryModal();
                    }
                    if (document.getElementById('flavors-modal').classList.contains('active')) {
                        closeFlavorsModal();
                    }
                    if (document.getElementById('driver-modal').classList.contains('active')) {
                        closeDriverModal();
                    }
                    if (document.getElementById('delivery-confirmation-modal').classList.contains('active')) {
                        closeDeliveryConfirmationModal();
                        currentSale = null;
                        pendingPrintOrder = null;
                    }
                    if (document.getElementById('payment-modal').classList.contains('active')) {
                        closePaymentModal();
                    }
                    if (document.getElementById('print-confirmation-modal').classList.contains('active')) {
                        closePrintConfirmationModal();
                        pendingPrintOrder = null;
                    }
                }
                // Permitir Enter no campo de senha
                if (e.key === 'Enter' && document.getElementById('admin-password') === document.activeElement) {
                    validateAndExecute();
                }
                // Permitir Enter no campo do entregador
                if (e.key === 'Enter' && document.getElementById('driver-name-input') === document.activeElement) {
                    document.getElementById('confirm-driver').click();
                }
                // Permitir Enter no campo de pagamento
                if (e.key === 'Enter' && document.getElementById('payment-modal').classList.contains('active') && selectedPaymentMethod) {
                    document.getElementById('confirm-payment-modal').click();
                }
            });
            
            // Tabs de navegação
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });
            
            // Botões de pedido impresso
            document.getElementById('print-order').addEventListener('click', printOrder);
            document.getElementById('clear-printed-order').addEventListener('click', clearPrintedOrder);
        }

        // Inicializar o sistema
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar e resetar dados diários
            checkAndResetDailyData();
            
            initializeProducts();
            initializeEventListeners();
            updateOrderSummary();
            populateYearSelects();
            loadDailyExpenses();
            loadDeliveryData();
            updatePrintedOrder();
            updateDayInfo();
            
            // Configurar mês atual nos seletores
            const currentMonth = new Date().getMonth();
            document.getElementById('month-select').value = currentMonth;
            
            // Verificar se há dados anteriores no localStorage
            const sales = JSON.parse(localStorage.getItem('açaiteria_sales') || '[]');
            if (sales.length > 0) {
                orderCounter = Math.max(...sales.map(s => s.id)) + 1;
            }
            
            // Inicializar na aba PDV
            switchTab('pdv');
            
            // Configurar verificação periódica de reset (a cada hora)
            setInterval(checkAndResetDailyData, 60 * 60 * 1000); // 1 hora
        });
    </script>
</body>
</html>